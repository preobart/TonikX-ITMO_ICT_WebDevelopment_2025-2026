<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Лабораторная 3 - Отчеты</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Отчеты</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../lab1/" class="nav-link">Лабораторная 1</a>
                            </li>
                            <li class="nav-item">
                                <a href="../lab2/" class="nav-link">Лабораторная 2</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Лабораторная 3</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../lab2/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#django-drf" class="nav-link">Лабораторная работа: Облачное файловое хранилище на Django и DRF</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#_1" class="nav-link">Ход выполнения</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_2" class="nav-link">Итоги работы</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="django-drf">Лабораторная работа: Облачное файловое хранилище на Django и DRF</h1>
<p>В рамках лабораторной работы я разработал облачное файловое хранилище на Django с использованием Django REST Framework.<br />
Система реализует хранение метаинформации о файлах, авторизацию пользователей и REST API для взаимодействия с контентом.<br />
Проект позволяет загружать, организовывать и безопасно делиться файлами между пользователями, а также управлять доступом через временные ссылки.</p>
<hr />
<h2 id="_1">Ход выполнения</h2>
<h3 id="1">1. Проектирование и создание моделей данных</h3>
<p>Сначала была спроектирована база данных для хранения информации о файлах и папках.<br />
Основные сущности:<br />
- <strong>Folder</strong> — папка, принадлежащая пользователю, может иметь родительскую папку (реализовано через <code>ForeignKey</code> на саму себя).<br />
- <strong>File</strong> — отдельный загруженный файл с информацией о размере, типе MIME, дате загрузки, ссылке на превью и принадлежности к пользователю и папке.<br />
- <strong>SharedLink</strong> — временная ссылка на файл, обеспечивающая безопасный доступ с ограничением по времени и количеству скачиваний.  </p>
<p><img alt="" src="../assets/lab3/models.png" /></p>
<hr />
<h3 id="2-api-django-rest-framework">2. Реализация API с помощью Django REST Framework</h3>
<p>После описания моделей я реализовал REST API для управления файлами и папками.<br />
В API предусмотрены следующие возможности:
- получение списка файлов и папок;
- загрузка и массовая загрузка файлов;
- перемещение файлов между папками;
- удаление файлов (реализовано мягкое удаление через поле <code>deleted_at</code>);
- скачивание и просмотр превью через Nginx с <code>X-Accel-Redirect</code>;
- создание временных ссылок для шаринга.  </p>
<p>Каждый запрос проверяет права доступа через кастомное разрешение <code>IsOwner</code>, чтобы пользователи могли работать только со своими файлами и каталогами.</p>
<p><img alt="" src="../assets/lab3/views.png" /></p>
<hr />
<h3 id="3-djoser-jwt">3. Подключение авторизации через Djoser и JWT</h3>
<p>Для регистрации и аутентификации пользователей я подключил библиотеку <strong>Djoser</strong> с поддержкой JWT-токенов.<br />
Пользователи могут создавать учётные записи, входить в систему, обновлять токены и получать информацию о текущем пользователе.<br />
Это позволило реализовать безопасный REST API, в котором каждый пользователь имеет собственное файловое пространство.</p>
<p><img alt="" src="../assets/lab3/auth.png" /></p>
<hr />
<h3 id="4">4. Генерация превью и асинхронная обработка файлов</h3>
<p>Для изображений и видео реализована система генерации превью.<br />
Я создал асинхронную задачу <code>generate_preview</code>, которая выполняется через <strong>Celery</strong>.<br />
Для изображений используется библиотека <strong>Pillow</strong>, а для видео — <strong>ffmpeg</strong>, где из видеофайла извлекается кадр и сохраняется как превью.<br />
Готовое изображение сохраняется в папке <code>previews</code>, а путь к нему прописывается в поле <code>preview_image</code>.</p>
<p><img alt="" src="../assets/lab3/previews.png" /></p>
<hr />
<h3 id="5">5. Реализация аналитики и агрегационных запросов</h3>
<p>Для демонстрации работы ORM я реализовал три агрегирующих запроса в отдельном модуле <strong>analytics</strong>:
1. Подсчёт общего объёма файлов, загруженных каждым пользователем.
2. Определение наиболее часто загружаемых типов MIME.
3. Подсчёт количества активных публичных ссылок для каждого пользователя.
4. M2M эндпоинт, указывающий на пользователей, которым предоставлен доступ
Результаты этих запросов используются в административной панели для отображения статистики работы системы.</p>
<p><img alt="" src="../assets/lab3/analytics.png" /></p>
<hr />
<h3 id="6">6. Модели сериализации</h3>
<p>Для передачи данных через API реализованы сериализаторы:
- <code>FileSerializer</code> — возвращает информацию о файле, а также ссылки для скачивания и превью;
- <code>FolderSerializer</code> — включает в себя вложенные папки и файлы (реализовано через <code>SerializerMethodField</code>);
- <code>SharedLinkSerializer</code> — сериализация временных ссылок.  </p>
<p><img alt="" src="../assets/lab3/serializers.png" /></p>
<hr />
<h2 id="_2">Итоги работы</h2>
<p>В результате лабораторной работы создано полноценное облачное файловое хранилище с REST API.<br />
Приложение реализует загрузку, хранение, организацию и безопасный доступ к файлам, поддерживает JWT-аутентификацию, генерацию превью, публичные ссылки и асинхронную обработку данных.  </p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
